var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

// Generated by CoffeeScript 2.1.0
(function () {
  /*
  jQuery Growl
  Copyright 2015 Kevin Sylvestre
  1.3.5
  */
  "use strict";

  var $, Animation, Growl;

  $ = jQuery;

  Animation = function () {
    var Animation = function () {
      function Animation() {
        _classCallCheck(this, Animation);
      }

      _createClass(Animation, null, [{
        key: "transition",
        value: function transition($el) {
          var el, ref, result, type;
          el = $el[0];
          ref = this.transitions;
          for (type in ref) {
            result = ref[type];
            if (el.style[type] != null) {
              return result;
            }
          }
        }
      }]);

      return Animation;
    }();

    ;

    Animation.transitions = {
      "webkitTransition": "webkitTransitionEnd",
      "mozTransition": "mozTransitionEnd",
      "oTransition": "oTransitionEnd",
      "transition": "transitionend"
    };

    return Animation;
  }();

  Growl = function () {
    var Growl = function () {
      _createClass(Growl, null, [{
        key: "growl",
        value: function growl() {
          var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

          return new Growl(settings);
        }
      }]);

      function Growl() {
        var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

        _classCallCheck(this, Growl);

        this.render = this.render.bind(this);
        this.bind = this.bind.bind(this);
        this.unbind = this.unbind.bind(this);
        this.mouseEnter = this.mouseEnter.bind(this);
        this.mouseLeave = this.mouseLeave.bind(this);
        this.click = this.click.bind(this);
        this.close = this.close.bind(this);
        this.cycle = this.cycle.bind(this);
        this.waitAndDismiss = this.waitAndDismiss.bind(this);
        this.present = this.present.bind(this);
        this.dismiss = this.dismiss.bind(this);
        this.remove = this.remove.bind(this);
        this.animate = this.animate.bind(this);
        this.$growls = this.$growls.bind(this);
        this.$growl = this.$growl.bind(this);
        this.html = this.html.bind(this);
        this.content = this.content.bind(this);
        this.container = this.container.bind(this);
        this.settings = $.extend({}, Growl.settings, settings);
        this.initialize(this.settings.location);
        this.render();
      }

      _createClass(Growl, [{
        key: "initialize",
        value: function initialize(location) {
          var id;
          id = 'growls-' + location;
          return $('body:not(:has(#' + id + '))').append('<div id="' + id + '" />');
        }
      }, {
        key: "render",
        value: function render() {
          var $growl;
          $growl = this.$growl();
          this.$growls(this.settings.location).append($growl);
          if (this.settings.fixed) {
            this.present();
          } else {
            this.cycle();
          }
        }
      }, {
        key: "bind",
        value: function bind() {
          var $growl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.$growl();

          $growl.on("click", this.click);
          if (this.settings.delayOnHover) {
            $growl.on("mouseenter", this.mouseEnter);
            $growl.on("mouseleave", this.mouseLeave);
          }
          return $growl.on("contextmenu", this.close).find("." + this.settings.namespace + "-close").on("click", this.close);
        }
      }, {
        key: "unbind",
        value: function unbind() {
          var $growl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.$growl();

          $growl.off("click", this.click);
          if (this.settings.delayOnHover) {
            $growl.off("mouseenter", this.mouseEnter);
            $growl.off("mouseleave", this.mouseLeave);
          }
          return $growl.off("contextmenu", this.close).find("." + this.settings.namespace + "-close").off("click", this.close);
        }
      }, {
        key: "mouseEnter",
        value: function mouseEnter(event) {
          var $growl;
          $growl = this.$growl();
          return $growl.stop(true, true);
        }
      }, {
        key: "mouseLeave",
        value: function mouseLeave(event) {
          return this.waitAndDismiss();
        }
      }, {
        key: "click",
        value: function click(event) {
          if (this.settings.url != null) {
            event.preventDefault();
            event.stopPropagation();
            return window.open(this.settings.url);
          }
        }
      }, {
        key: "close",
        value: function close(event) {
          var $growl;
          event.preventDefault();
          event.stopPropagation();
          $growl = this.$growl();
          return $growl.stop().queue(this.dismiss).queue(this.remove);
        }
      }, {
        key: "cycle",
        value: function cycle() {
          var $growl;
          $growl = this.$growl();
          return $growl.queue(this.present).queue(this.waitAndDismiss());
        }
      }, {
        key: "waitAndDismiss",
        value: function waitAndDismiss() {
          var $growl;
          $growl = this.$growl();
          return $growl.delay(this.settings.duration).queue(this.dismiss).queue(this.remove);
        }
      }, {
        key: "present",
        value: function present(callback) {
          var $growl;
          $growl = this.$growl();
          this.bind($growl);
          return this.animate($growl, this.settings.namespace + "-incoming", 'out', callback);
        }
      }, {
        key: "dismiss",
        value: function dismiss(callback) {
          var $growl;
          $growl = this.$growl();
          this.unbind($growl);
          return this.animate($growl, this.settings.namespace + "-outgoing", 'in', callback);
        }
      }, {
        key: "remove",
        value: function remove(callback) {
          this.$growl().remove();
          return typeof callback === "function" ? callback() : void 0;
        }
      }, {
        key: "animate",
        value: function animate($element, name) {
          var direction = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'in';
          var callback = arguments[3];

          var transition;
          transition = Animation.transition($element);
          $element[direction === 'in' ? 'removeClass' : 'addClass'](name);
          $element.offset().position;
          $element[direction === 'in' ? 'addClass' : 'removeClass'](name);
          if (callback == null) {
            return;
          }
          if (transition != null) {
            $element.one(transition, callback);
          } else {
            callback();
          }
        }
      }, {
        key: "$growls",
        value: function $growls(location) {
          var base;
          if (this.$_growls == null) {
            this.$_growls = [];
          }
          return (base = this.$_growls)[location] != null ? base[location] : base[location] = $('#growls-' + location);
        }
      }, {
        key: "$growl",
        value: function $growl() {
          return this.$_growl != null ? this.$_growl : this.$_growl = $(this.html());
        }
      }, {
        key: "html",
        value: function html() {
          return this.container(this.content());
        }
      }, {
        key: "content",
        value: function content() {
          return "<div class='" + this.settings.namespace + "-close'>" + this.settings.close + "</div>\n<div class='" + this.settings.namespace + "-title'>" + this.settings.title + "</div>\n<div class='" + this.settings.namespace + "-message'>" + this.settings.message + "</div>";
        }
      }, {
        key: "container",
        value: function container(content) {
          return "<div class='" + this.settings.namespace + " " + this.settings.namespace + "-" + this.settings.style + " " + this.settings.namespace + "-" + this.settings.size + "'>\n  " + content + "\n</div>";
        }
      }]);

      return Growl;
    }();

    ;

    Growl.settings = {
      namespace: 'growl',
      duration: 3200,
      close: "&#215;",
      location: "default",
      style: "default",
      size: "medium",
      delayOnHover: true
    };

    return Growl;
  }();

  this.Growl = Growl;

  $.growl = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    return Growl.growl(options);
  };

  $.growl.error = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var settings;
    settings = {
      title: "Error!",
      style: "error"
    };
    return $.growl($.extend(settings, options));
  };

  $.growl.notice = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var settings;
    settings = {
      title: "Notice!",
      style: "notice"
    };
    return $.growl($.extend(settings, options));
  };

  $.growl.info = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var settings;
    settings = {
      title: "Notice!",
      style: "info"
    };
    return $.growl($.extend(settings, options));
  };

  $.growl.warning = function () {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

    var settings;
    settings = {
      title: "Warning!",
      style: "warning"
    };
    return $.growl($.extend(settings, options));
  };
}).call(this);

(function($){

	$.fn.textWidth = function(){
		var calc = '<span style="display:none">' + $(this).text() + '</span>';
		$('body').append(calc);
		var width = $('body').find('span:last').width();
		$('body').find('span:last').remove();
	   return width;
   };
   
   $.fn.marquee = function(args) {
	   var that = $(this);
	   var textWidth = that.textWidth(),
		   offset = that.width(),
		   width = offset,
		   css = {
			   'text-indent' : that.css('text-indent'),
			   'overflow' : that.css('overflow'),
			   'white-space' : that.css('white-space')
		   },
		   marqueeCss = {
			   'text-indent' : width,
			   'overflow' : 'hidden',
			   'white-space' : 'nowrap'
		   },
		   args = $.extend(true, { count: -1, speed: 1e1, leftToRight: false }, args),
		   i = 0,
		   stop = textWidth*-1,
		   dfd = $.Deferred();
	   
	   function go() {
		   if(!that.length) return dfd.reject();
		   if(width == stop) {
			   i++;
			   if(i == args.count) {
				   that.css(css);
				   return dfd.resolve();
			   }
			   if(args.leftToRight) {
				   width = textWidth*-1;
			   } else {
				   width = offset;
			   }
		   }
		   that.css('text-indent', width + 'px');
		   if(args.leftToRight) {
			   width++;
		   } else {
			   width--;
		   }
		   setTimeout(go, args.speed);
	   };
	   if(args.leftToRight) {
		   width = textWidth*-1;
		   width++;
		   stop = offset;
	   } else {
		   width--;            
	   }
	   that.css(marqueeCss);
	   go();
	   return dfd.promise();
   };

})(jQuery);

function getUri(basepath,num){
	var x = document.URL;
	var y = x.replace(basepath,"");
	num -= 1;
	var segment	= y.split('/');
	if (segment[num] != undefined) {
		 return segment[num].replace(/\#/g,"");
	}
	return '';
}

function alertModals(element, title, message){
	
	var html = '';
	html += '<div id="'+element+'" class="modal modal-alert modal-danger fade">';
		html += '<div class="modal-dialog">';
			html += '<div class="modal-content">';
				html += '<div class="modal-header">';
					html += '<i class="fa fa-times-circle"></i>';
				html += '</div>';
				html += '<div class="modal-title">asd</div>';
				html += '<div class="modal-body">sss</div>';
				html += '<div class="modal-footer">';
					html += '<button type="button" class="btn btn-danger" data-dismiss="modal">OK</button>';
				html += '</div>';
			html += '</div>';
		html += '</div>';
	html += '</div>';
	return html;
	
	
}

var dg_height	= $(document).height() - ( $('#main-navbar').height() + $('.mail-container-header').outerHeight());
var dg_min		= $('.mail-container-header').height() + $('.mail-controls').height() + 55;
var dg_mail		= $('.page-mail .mail-nav').height() - dg_min;
var dg_mail_sc	= dg_mail - 70;

$.post( site_url + 'app/show_notification', function(res){
	$('.notif-top-page').html('');
	if(res.status){
		if(res.info != ''){
			$('.notif-top-page').html(res.info).removeClass('hidden').marquee();
		}
	}
},"json");

/* CUSTOMER CARE */
if($('#page-dg-customer-care').length > 0)
{

	$(window).on('resize', function(){
		$('#dgContact').datagrid('resize');
	})

	$.post ( site_url + 'ccare/load_grid_data', function(res){
		$('#product').select2({minimumResultsForSearch:Infinity, data:res.product});
		$('#start').val(res.date_start);
		$('#end').val(res.date_end);
	},"json");

	$('#btn-search').on('click', function(){
		$('#dgContact').datagrid('reload',{search:$('#key').val(), product:$('#product').val(), start:$('#start').val(), end:$('#end').val()});
	});

	//$('#date').daterangepicker();

	$('#dgContact').datagrid({
		url: site_url + 'ccare/get_data_list',
		//title:'Data Ticket',
		height: dg_height,
		nowrap: false,
		striped: true,
		remoteSort: true,
		singleSelect: true,
		fitColumns: true,
		pagination:true,
		rownumbers:true,
		pageSize:25,
		pageList:[25,50,75,100],
		//toolbar:"#toolbar",
		queryParams: {
			start:$('#start').val(),
			end:$('#end').val()
		},
		frozenColumns:[[
			{field:'no_ticket',title:'No Ticket', width:100, sortable:true, align:'left'},
			{field:'date',title:'Tgl Aduan', width:100, sortable:true, align:'left'},
			{field:'last_update',title:'Tgl Update', width:100, sortable:true, align:'left'},
			{field:'awb',title:'ID Kirim', width:100, sortable:true, align:'left'},
		]],
		columns:[[
			{field:'jenis_layanan_name',title:'Jenis Produk',width:100, sortable:true, align:'left'},
			{field:'user_cch',title:'User CCH',width:200, sortable:true, align:'left'},
			{field:'kantor_tujuan_pengaduan',title:'Tujuan Pengaduan',width:200, sortable:true, align:'left'},
			{field:'ticket_status',title:'Status Akhir',width:200, sortable:true, align:'left',
				styler: function(v,row,index){
					
					if(row.ticket_val == 1){
						return 'background-color:#f4bb04;color:#FFF;';
					}else if(row.ticket_val == 12){
						return 'background-color:#138496;color:#FFF;';
					}else if(row.ticket_val == 17){
						return 'background-color:#1d89cf;color:#FFF;';
					}else if(row.ticket_val == 99){
						return 'background-color:#218838;color:#FFF;';
					}
				}
			
			},
		]],
		
		onSelect: function(i, r){
			var count = $("#grid-body").children().length;
			if(count > 1){
				$('#grid-body > div.info-side-index').remove();
			}
			$('#grid-body > div:first').removeClass('col-md-12').addClass('col-md-8');
			
			var html_loader = '<div class="block-loader" id="loader-element" style="text-align: center; vertical-align: middle; height: 200px; margin-top: 25%; margin-bottom: auto;"><div class="lds-ripple"><div></div><div></div></div></div>';
			
			$('#grid-body').append(html_loader);
			$.post( site_url + 'ccare/load_detail_info',{ uid: r.id}, function(res){
				$('#grid-body #loader-element').remove();
				$('#grid-body').append('<div class="col-md-4 info-side-index bg-info" style="overflow:auto; height:'+dg_height+'px; margin-left:-11px;">'+res+'</div>');
			});
			$('#dgContact').datagrid('resize');
		}
	})

	
}

if($('#page-form-customer-care').length > 0)
{
	
	$('.select2min').select2({minimumResultsForSearch:Infinity});
	
	$.post ( site_url + 'contacts/form_data', function(res){
		$('#channel').select2({data:res.source, minimumResultsForSearch:Infinity});

		var $select = $('#type_of_request');
		var html 	= '';
		$.each(res.basic, function(i, optgroups) {
			html += '<optgroup label="'+i+'">';
			$.each(optgroups, function(groupName, options) {
				html += '<option value="'+options.id+'">'+options.text+'</option>';
			});
			html += '</optgroup>';
		});
		$select.append(html);
		
		$('#type_of_request').select2({minimumResultsForSearch:Infinity});
		if(localStorage.cTicket_channel != null){
			$('#channel').val(localStorage.cTicket_channel).trigger('change');
		}
		if(localStorage.cTicket_category != null){
			$('#type_of_request').val(localStorage.cTicket_category).trigger('change');
			$.post( site_url + 'ccare/load_form_helper',{type_id : localStorage.cTicket_category}, function(data){
				$('#forms-helper').html(data);
				$('.block-loader').addClass('hidden');
			});
		}
		$('#requester').val(localStorage.cTicket_requester);
		$('#address').val(localStorage.cTicket_address);
		
	},"json");
	//console.log(localStorage.cTicket_channel);
	

	$('#channel').on('select2:select', function (e) {
		$('#phone').rules('remove','required');
		$('#email').rules('remove','required');
		$('#instagram').rules('remove','required');
		$('#facebook').rules('remove','required');
		$('#twitter').rules('remove','required');
		$('span.required').addClass('hidden');
		var data = e.params.data;
		if(data.text == 'Instagram'){
			$('#instagram').rules('add', {'required':true});
			$('label[for=instagram] span.required').removeClass('hidden');
		}else if(data.text == 'Twitter'){
			$('#twitter').rules('add', {'required':true});
			$('label[for=twitter] span.required').removeClass('hidden');
		}else if(data.text == 'Facebook'){
			$('#facebook').rules('add', {'required':true});
			$('label[for=facebook] span.required').removeClass('hidden');
		}else if(data.text == 'Email'){
			$('#email').rules('add', {'required':true});
			$('label[for=email] span.required').removeClass('hidden');
		}else{
			$('#phone').rules('add', {'required':true});
			$('label[for=phone] span.required').removeClass('hidden');
		}
	});

	$('#type_of_request').on('select2:select', function (e) {
		var data = e.params.data;
		if(data.id != ''){
			$('.block-loader').removeClass('hidden');
			$.post( site_url + 'ccare/load_form_helper',{type_id : data.id}, function(data){
				$('#forms-helper').html(data);
				$('.block-loader').addClass('hidden');
			});
		}
	});
	
	$('#email').on('keyup', function(){
		var val = $(this).val();
		if(val != ""){
			$('#phone').rules("remove","required");
		}else{
			$('#phone').rules("add",{required:true});
		}
	});
	
	$("#phone").select2({
		ajax: {
			url: site_url + 'ccare/customer_lookup',
			dataType: 'json',
			method:"post",
			processResults: function (data) {
				return {
					results: $.map(data, function (item) {
						return item;
					})
				};
			},
			cache: true
		},
		minimumInputLength : 4,
		tags: true,
		createTag: function (params) {
			return {
				id: params.term,
				text: params.term,
				newOption: true
			}
		},
		templateResult: function (data) {
			var $result = $("<span></span>");
			$result.text(data.text);
			if (data.newOption) {
				$result.append(" <em>(baru)</em>");
			}
			return $result;
		}
	}).on('select2:select', function (e) {
		
		$('#newCustomer').val(0);
		var data = e.params.data;
		if(data.newOption){
			$('#newCustomer').val(1);
			$('#email, #requester, #address, #uid, #instagram, #facebook, #twitter').val('');
			$('#sm_email, #sm_requester, #sm_address, #sm_instagram, #sm_facebook, #sm_twitter').text('');
		}else{
			($('#facebook').val() == '') ? $('#facebook').val(data.facebook) : $('#sm_facebook').text(data.facebook);
			($('#email').val() == '') ? $('#email').val(data.email) : $('#sm_email').text(data.email);
			($('#requester').val() == '') ? $('#requester').val(data.name) : $('#sm_requester').text(data.name);
			($('#address').val() == '') ? $('#address').val(data.address) : $('#sm_address').text(data.address);
			($('#instagram').val() == '') ? $('#instagram').val(data.instagram) : $('#sm_instagram').text(data.instagram);
			($('#twitter').val() == '') ? $('#twitter').val(data.twitter) : $('#sm_twitter').text(data.twitter);

			//$('#email').val(data.email );
			//$('#requester').val(data.name);
			//$('#address').val(data.address);
			$('#uid').val(data.uid);
		}
		
		
	});

	
	//var phoneDefault 	= localStorage.cTicket_phone;
	//if(phoneDefault != null){
		//$('#select2-phone-container').attr('title', phoneDefault).text(phoneDefault);
		var newOption = new Option(localStorage.cTicket_phone, localStorage.cTicket_phone, false, false);
		$('#phone').append(newOption).trigger('change');
	//}
	//$('#phone').val(localStorage.cTicket_phone).trigger('change');
	
	$('#ccare-form').validate({
		rules:{
			channel : {required:true},
			requester: {required: true},
			email: {email:true},
			phone: {required:true},
			type_of_request:{required:true}
		},
		submitHandler: function(form) {
			$('#btn-submit-form').addClass('running').attr('disabled','disabled');
			$.post ( site_url + 'ccare/save_data', $('#ccare-form').serialize(), function(res){

				if(res){
					let keysToRemove = ["cTicket_address", "cTicket_awb", "cTicket_category","cTicket_channel","cTicket_notes","cTicket_phone","cTicket_requester"];
					for (key of keysToRemove) {
						localStorage.removeItem(key);
					}
					swal({
						title: "Success!",
						text: res.message,
						content:"success",
						//timer: 2000,
						buttons: {
							cancel: "Kembali",
							addnew: "Aduan Baru",
							lastcust: "Tambah Pengaduan" 
						},
						closeOnEsc: false,
						closeOnClickOutside: false
					}).then((value) => {
						switch (value) {
							case "addnew":
							  window.location.reload();
							  break;
							case "lastcust":
								$('#forms-helper').html('');
								$('#type_of_request').val('').trigger('change');
								break;
							default:
								window.location.href = site_url + 'ccare';
						}
					});
				}else{
					swal("Sorry",res.message, "error");
				}

				$('#btn-submit-form').removeClass('running').removeAttr('disabled');
			},"json");	
		}
	})
}
/* END CUSTOMER CARE */



// HOLIDAY
if($('#page-holiday').length > 0)
{
	$('#holiday-form').validate({
		rules:{
			title:{required:true},
			description:{required:true},
			start:{required:true}
		},
		submitHandler: function(form) {
			$.post(site_url + 'holiday/save', $('#holiday-form').serialize(), function(res){
				if(res.status){
					swal({
						title: "Success!",
						text: res.message,
						content:"success",
						//timer: 2000,
						buttons: {
							cancel: "Kembali",
							addnew: "Tambah Lagi"
						},
						closeOnEsc: false,
						closeOnClickOutside: false
					}).then((value) => {
						switch (value) {
							case "addnew":
							window.location.reload();
							break;
							default:
								window.location.href = site_url + 'holiday';
						}
					});
				}else{
					swal("Sorry",res.message, "error");
				}	
				
			},"json");
		}
	});
	
	$('#dgMacro').datagrid({
		url: site_url + 'holiday/get_datalist',
		height: dg_height - 50,
		nowrap: false,
		striped: true,
		remoteSort: true,
		singleSelect: true,
		fitColumns: true,
		pagination:true,
		rownumbers:true,
		pageSize:25,
		pageList:[25,50,75,100],
		toolbar:"#toolbar",
		queryParams: {
		},
		columns:[[
			{field:'dstart',title:'Tanggal',width:50, sortable:true, align:'center',
				formatter:function(v,r,i){
					if(v == r.dend){
						return v;
					}else{
						return v+" - "+r.dend;
					}
				}
			},
			{field:'title',title:'Nama', width:200, sortable:true, align:'left',
				formatter:function(v,r,i){
					return "<strong>"+v+"</strong>";
				}
			},
			
			{field:'id',title:'Action',width:50, sortable:true, align:'center',
				formatter:function(v,r,i){
					//var edit 	= '<a href="javascript:void(0);" onclick="javascript:_editForm(\'holiday/form/'+v+'\',\''+v+'\');" class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></a>';
					var edit = '<a href="javascript:void(0);" onclick="javascript:_editFormPopUp(\'modal_form_holiday\', \'holiday/load_event\', \''+v+'\', \'holiday-form\');" class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></a>';
					var remove 	= '<a href="javascript:void(0);" onclick="javascript:_removeData(\'holiday/delete\',\''+v+'\',\'dgMacro\',);" class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></a>';
					return edit +' '+ remove;
				}
			}
		]]
	})
}

if($('#page-holiday-form').length > 0)
{
	//$('#end').removeAttr('disabled');
	$.post( site_url + 'holiday/form_load',{uid : getUri(site_url,3)},function(res){
		
		$('#holiday-form').form('load', res.form);
		//if(res.form.uid != undefined){
		//	$('#end').attr('disabled','disabled');
		//}
	},"json");

	$('#holiday-form').validate({
		rules:{
			title:{required:true},
			description:{required:true},
			start:{required:true}
		},
		submitHandler: function(form) {
			$.post(site_url + 'holiday/save', $('#holiday-form').serialize(), function(res){
				if(res.status){
					swal({
						title: "Success!",
						text: res.message,
						content:"success",
						//timer: 2000,
						buttons: {
							cancel: "Kembali",
							addnew: "Tambah Lagi"
						},
						closeOnEsc: false,
						closeOnClickOutside: false
					}).then((value) => {
						switch (value) {
							case "addnew":
							window.location.reload();
							break;
							default:
								window.location.href = site_url + 'holiday';
						}
					});
				}else{
					swal("Sorry",res.message, "error");
				}	
				
			},"json");
		}
	});
}
// -- END HOLDAY

// INIT PUSH
init.push(function () {
		
		
	var dg_height	= $(document).height() - ( $('#main-navbar').height() + $('.mail-container-header').outerHeight());
	
	var dg_min		= $('.mail-container-header').height() + $('.mail-controls').height() + 55;
	var dg_mail		= $('.page-mail .mail-nav').height() - dg_min;
	var dg_mail_sc	= dg_mail - 70;


	

	// NOTIF
	if($('#page-notification').length > 0)
	{
		$('#dgMacro').datagrid({
			url: site_url + 'notification/get_datalist',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				//start: $('#start').val(),
				//end: $('#end').val()
			},
			columns:[[
				{field:'title',title:'Nama', width:200, sortable:true, align:'left',
					formatter:function(v,r,i){
						return "<strong>"+v+"</strong><br/>"+r.description;
					}
				},
				{field:'event_date',title:'Tgl Acara',width:50, sortable:true, align:'center'},
				{field:'id',title:'Action',width:50, sortable:true, align:'center',
					formatter:function(v,r,i){
						var edit 	= '<a href="javascript:void(0);" onclick="javascript:_editForm(\'notification/form/'+v+'\',\''+v+'\');" class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></a>';
						var remove 	= '<a href="javascript:void(0);" onclick="javascript:_removeData(\'notification/delete\',\''+v+'\',\'dgMacro\',);" class="btn btn-xs btn-danger"><i class="fa fa-trash-o"></i></a>';
						
						return edit +' '+ remove;
					}
				}
			]]
		})
	}

	if($('#page-notification-form').length > 0)
	{
		$('#end').removeAttr('disabled');
		$.post( site_url + 'notification/form_load',{uid : getUri(site_url,3)},function(res){
			
			$('#notification-form').form('load', res.form);
			if(res.form.uid != undefined){
				$('#end').attr('disabled','disabled');
			}
		},"json");

		$('#notification-form').validate({
			rules:{
				title:{required:true},
				description:{required:true},
				start:{required:true}
			},
			submitHandler: function(form) {
				$.post(site_url + 'notification/save', $('#notification-form').serialize(), function(res){
					if(res.status){
						swal({
							title: "Success!",
							text: res.message,
							content:"success",
							//timer: 2000,
							buttons: {
								cancel: "Kembali",
								addnew: "Tambah Lagi"
							},
							closeOnEsc: false,
							closeOnClickOutside: false
						}).then((value) => {
							switch (value) {
								case "addnew":
								window.location.reload();
								break;
								default:
									window.location.href = site_url + 'notification';
							}
						});
					}else{
						swal("Sorry",res.message, "error");
					}	
					
				},"json");
			}
		});
	}

	// -- END NOTIF 


	if($('#page-report-dashboard').length > 0)
	{
		/*
		var chart_kpi_event = document.getElementById('chart_kpi');
		chart_kpi_event.onclick = function(evt) {
			
			var activePoints = myChart.getElementsAtEvent(evt);
			if (activePoints[0]) {
				var chartData = activePoints[0]['_chart'].config.data;
				var idx = activePoints[0]['_index'];

				var label = chartData.labels[idx];
				var value = chartData.datasets[0].data[idx];
				console.log(activePoints[0]);
			}
			
		}
		*/
		function update_chart(kpi){
			$.post( site_url + 'report/update_chart',{kpi:kpi, month:$('#month').val(), year:$('#year').val()},function(res){
				kantorAsal.data = res.asal;
				kantorAsal.update();
				
				kantorTujuan.data = res.tujuan;
				kantorTujuan.update();

				cProduct.data = res.product;
				cProduct.update();
			},"json");
		}

		function update_chart_asal(kpi, asal){
			$.post( site_url + 'report/update_chart',{kpi:kpi, asal:asal, month:$('#month').val(), year:$('#year').val()},function(res){
				
				kantorTujuan.data = res.tujuan;
				kantorTujuan.update();

				cProduct.data = res.product;
				cProduct.update();

			},"json");
		}
		var kpi_selected = "";
		var asal_selected = "";
		var tujuan_selected = "";
		var kpi_default_radius;
		
		var ctx = document.getElementById('chart_kpi').getContext('2d');
		var myChart = new Chart(ctx, {
			type: 'pie',
			options: {
				onClick: function(evt, activeElements) {
					var elementIndex = activeElements[0]._index;
					var clickedLabel = this.data.labels[elementIndex];
					
					
					if (kpi_selected.toUpperCase() == "") {
						kpi_selected = clickedLabel.toUpperCase();
					}else if (clickedLabel.toUpperCase() == kpi_selected.toUpperCase()){
						kpi_selected = "";
					}else{
						kpi_selected = clickedLabel.toUpperCase();
					}

					update_chart(kpi_selected);

					
					
					//var clickedElementindex = activePoints[0]["_index"];
					/*
					if( ($('#kpi_value').val() == '') || ($('#kpi_value').val() != this.data.labels[elementIndex]) ){
						var org_color 	 = this.data.datasets[0].backgroundColor[elementIndex];
						this.data.datasets[0].backgroundColor[elementIndex] = 'black';
						$('#kpi_org_color').val(org_color);
						$('#kpi_value').val(this.data.labels[elementIndex]);
						this.update();
					}else{
						this.data.datasets[0].backgroundColor[elementIndex] = $('#kpi_org_color').val();
						$('#kpi_org_color').val('');
						$('#kpi_value').val('');
						this.update();
					}
					*/
				},
				legend: {
					position : 'right',
					labels: { fontColor: 'black', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						title: function(tooltipItem, data) {
							var currentLabel = data.labels[tooltipItem[0].index];
							//return currentLabel;
						},
						label: function(tooltipItem, data) {
							
							
							var currentLabel = data.labels[tooltipItem.index]
							//return percentage + " % ";
							return "Aduan diselesaikan "+currentLabel+" :";
							//var multistringText = ["Diselesaikan "+currentLabel+" :"];
							//multistringText.push("Jumlah Aduan "+currentValue +"( "+percentage+"% )");
							//return multistringText;
						},
						footer: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem[0].datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem[0].index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         

							var multistringText = ["Jumlah : "+currentValue+" "];
							multistringText.push("Persentase : "+percentage+" %");
							return multistringText;
						}
					}
				}
			}
		});
		
		
		var ctx = document.getElementById('chart_kantor_asal').getContext('2d');
		var kantorAsal = new Chart(ctx, {
			type: 'pie',
			options: {
				onClick: function(evt, activeElements) {
					var elementIndex = activeElements[0]._index;
					var clickedLabel = this.data.labels[elementIndex];
					
					
					if (asal_selected == "") {
						asal_selected = clickedLabel;
					}else if (clickedLabel == asal_selected){
						asal_selected = "";
					}else{
						asal_selected = clickedLabel;
					}

					update_chart_asal(kpi_selected, asal_selected);
					/*
					$.pos( site_url + 'report/update_chart', function(res){

					},"json");
					
					if( ($('#kpi_value').val() == '') || ($('#kpi_value').val() != this.data.labels[elementIndex]) ){
						var org_color 	 = this.data.datasets[0].backgroundColor[elementIndex];
						this.data.datasets[0].backgroundColor[elementIndex] = 'black';
						$('#kpi_org_color').val(org_color);
						$('#kpi_value').val(this.data.labels[elementIndex]);
						this.update();
					}else{
						this.data.datasets[0].backgroundColor[elementIndex] = $('#kpi_org_color').val();
						$('#kpi_org_color').val('');
						$('#kpi_value').val('');
						this.update();
					}
					*/
				},
				legend: {
					position : 'right',
					labels: { fontColor: 'black', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						title: function(tooltipItem, data) {
							var currentLabel = data.labels[tooltipItem[0].index];
							//return currentLabel;
						},
						label: function(tooltipItem, data) {
							
							
							var currentLabel = data.labels[tooltipItem.index]
							//return percentage + " % ";
							return " "+currentLabel+" :";
							//var multistringText = ["Diselesaikan "+currentLabel+" :"];
							//multistringText.push("Jumlah Aduan "+currentValue +"( "+percentage+"% )");
							//return multistringText;
						},
						footer: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem[0].datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem[0].index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         

							var multistringText = ["Jumlah : "+currentValue+" "];
							multistringText.push("Persentase : "+percentage+" %");
							return multistringText;
						}
					}
				}
			}
		});


		var ctx = document.getElementById('chart_kantor_tujuan').getContext('2d');
		var kantorTujuan = new Chart(ctx, {
			type: 'pie',
			options: {
				onClick: function(evt, activeElements) {
					var elementIndex = activeElements[0]._index;
					/*
					if( ($('#kpi_value').val() == '') || ($('#kpi_value').val() != this.data.labels[elementIndex]) ){
						var org_color 	 = this.data.datasets[0].backgroundColor[elementIndex];
						this.data.datasets[0].backgroundColor[elementIndex] = 'black';
						$('#kpi_org_color').val(org_color);
						$('#kpi_value').val(this.data.labels[elementIndex]);
						this.update();
					}else{
						this.data.datasets[0].backgroundColor[elementIndex] = $('#kpi_org_color').val();
						$('#kpi_org_color').val('');
						$('#kpi_value').val('');
						this.update();
					}
					*/
				},
				legend: {
					position : 'right',
					labels: { fontColor: 'black', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						title: function(tooltipItem, data) {
							var currentLabel = data.labels[tooltipItem[0].index];
							//return currentLabel;
						},
						label: function(tooltipItem, data) {
							
							
							var currentLabel = data.labels[tooltipItem.index]
							//return percentage + " % ";
							return ""+currentLabel+" :";
							//var multistringText = ["Diselesaikan "+currentLabel+" :"];
							//multistringText.push("Jumlah Aduan "+currentValue +"( "+percentage+"% )");
							//return multistringText;
						},
						footer: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem[0].datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem[0].index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         

							var multistringText = ["Jumlah : "+currentValue+" "];
							multistringText.push("Persentase : "+percentage+" %");
							return multistringText;
						}
					}
				}
			}
		});


		var ctx = document.getElementById('chart_product').getContext('2d');
		var cProduct = new Chart(ctx, {
			type: 'horizontalBar',
			options: {
				legend: {  display : false },
			}
			//data: [{"x":"Surat Kilat Khusus","y":3},{"x":"POS Express","y":3},{"x":"Paket Biasa Internasional","y":1},{"x":"Express Mail Services","y":1}]
		});
		$.post( site_url + 'report/load_chart', function(data){
			myChart.data = data.report;	
			myChart.update();

			kantorAsal.data = data.asal;	
			kantorAsal.update();

			kantorTujuan.data = data.tujuan;	
			kantorTujuan.update();

			cProduct.data = data.product;
			cProduct.update();
			
		},'json');

		$('.select2min').select2({minimumResultsForSearch:Infinity});
		$('#month').on('select2:select', function (e) {
			var data = e.params.data;
			console.log(data.id);
			reload_chart();
		});

		function reload_chart()
		{
			$.post( site_url + 'report/load_chart',{month:$('#month').val(), year:$('#year').val()}, function(data){
				myChart.data = data.report;	
				myChart.update();

				kantorAsal.data = data.asal;	
				kantorAsal.update();

				kantorTujuan.data = data.tujuan;	
				kantorTujuan.update();

				cProduct.data = data.product;
				cProduct.update();
				
			},'json');
		}
		
	}
	if($('#page-dashboard').length > 0)
	{
		
		var ctx = document.getElementById('chart_service_type').getContext('2d');
		var myChart = new Chart(ctx, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				}
			}
		});

		var c_jenis_layanan = document.getElementById('chart_jenis_layanan').getContext('2d');
		var myCJenisLayanan = new Chart(c_jenis_layanan, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				}
			}
		});

		var cstatus = document.getElementById('chart_status').getContext('2d');
		var myCStatus = new Chart(cstatus, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						label: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem.datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem.index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         
							return percentage + " % ";
						}
					}
				}
			}
		});

		// 
		var pencapaian_out = document.getElementById('chart_service_type_out').getContext('2d');
		var kpi_out = new Chart(pencapaian_out, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				}
			}
		});

		var c_jenis_layanan_out = document.getElementById('chart_jenis_layanan_out').getContext('2d');
		var myCJenisLayanan_out = new Chart(c_jenis_layanan_out, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				}
			}
		});

		var cstatus_out = document.getElementById('chart_status_out').getContext('2d');
		var myCStatus_out = new Chart(cstatus_out, {
			type: 'pie',
			options: {
				legend: {
					position : 'right',
					labels: { fontColor: 'white', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						label: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem.datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem.index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         
							return percentage + " % ";
						}
					}
				}
			}
		});

		$.post( site_url + 'home/getTicketMonthly', function(data){
			myChart.data = data.kiriman;	
			myChart.update();
			
			myCJenisLayanan.data = data.product;
			myCJenisLayanan.update();

			myCStatus.data = data.status;
			myCStatus.update();
			//
			kpi_out.data = data.kiriman_out;	
			kpi_out.update();
			
			myCJenisLayanan_out.data = data.product_out;
			myCJenisLayanan_out.update();

			myCStatus_out.data = data.status_out;
			myCStatus_out.update();

			$('#avg_hour > strong').text(data.avg_time);
			/*
			var ctx = document.getElementById('chart_service_type').getContext('2d');
			var myChart = new Chart(ctx, {
				type: 'pie',
				data: {"datasets":[{"data":[8,1]}],"labels":["domestik","internasional"]}
			});

			*/
			
		},'json');
		
	}

	// Gagal Xray
	if($('#page_form_xray').length > 0)
	{
		$('#myxray-form').validate({
			rules:{
				kantor_penerbangan:{required:true},
				id_kiriman:{required:true},
				isi_kiriman:{required:true},
				keterangan:{required:true}
			},
			submitHandler: function(form) {
				$.post( site_url + 'xray/save_data', $('#myxray-form').serialize(), function(res){
					if(res){
						swal({
							title: "Success!",
							text: res.message,
							content:"success",
							//timer: 2000,
							buttons: {
								cancel: "Back to list",
								addnew: "Add More"
							},
							closeOnEsc: false,
							closeOnClickOutside: false
						}).then((value) => {
							switch (value) {
								case "addnew":
								  window.location.reload();
								  break;

								default:
									window.location.href = site_url + 'xray';
							}
						});
					}else{
						swal("Sorry",res.message, "error");
					}
				},"json");
			}
		});
		
		$('.input-search-kantorpos').select2({
			ajax: {
				url: site_url + 'app/kantor_posdd_new',
				dataType: 'json',
				method:"POST",
				delay: 250,
				data: function (params) {
					var query = {
						city: params.term
					}
					return query;
				},
				processResults: function (data) {
					return {
						results : data
					}
				},
				cache: true
			},
			placeholder: 'Kantor Pos',
			minimumInputLength: 1,
		})
	}
	if($('#page-dg-xray').length > 0)
	{
		var interval = '';
		$(window).on('resize', function(){
			$('#dgContact').datagrid('resize');
		})

		$('#dgContact').datagrid({
			url: site_url + 'xray/get_data_list',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			//toolbar:"#toolbar",
			queryParams: {
			},
			columns:[[
				
				{field:'kode_kantor_aduan',title:'kantor Penerbangan',width:45,
					formatter:function(v,r,i){
						return r.kantor_aduan;
					}
				},
				{field:'tgl_input_id',title:'Tgl Input', width:20, sortable:true, align:'left'},
				{field:'kode_kantor_asal',title:'Kantor Asal',width:45,
					formatter:function(v,r,i){
						return r.kantor_asal;
					}
				},
				{field:'kode_kantor_tujuan',title:'Kantor Tujuan',width:45,
					formatter:function(v,r,i){
						return r.kantor_tujuan;
					}
				},
				{field:'id_kiriman',title:'ID Kiriman',width:25, sortable:true},
				{field:'kantong_lama',title:'Ktng Lama',width:25, sortable:true},
				{field:'kantong_baru',title:'ktng Baru',width:25, sortable:true},
				
				{field:'isi_kiriman',title:'Isi Kiriman',width:30, sortable:true},
				{field:'berat',title:'Berat (Kg)',width:20, sortable:true, align:'right'},
				{field:'keterangan',title:'Keterangan',width:30, sortable:true},
				//{field:'user_cch',title:'User Input',width:10, sortable:true}
			]]
		})
		
		$('#btn-search').on('click',function(){
			$('#dgContact').datagrid('reload',{search:$('#key-search').val()});
		});
		$('#key-search').on('keyup', function(){
			if($(this).val() ==''){
				$('#dgContact').datagrid('reload', {search:$('#key-search').val()});
			}
		});
		
		$('#fileupload').fileupload({
			url: site_url + 'xray/do_upload',
			dataType: 'json',
			done: function (e, data) {
				$.each(data.result.files, function (index, file) {
					$('<p/>').text(file.name).appendTo('#files');
				});
			},
			progressall: function (e, data) {
				var progress = parseInt(data.loaded / data.total * 100, 10);
				$('#progress .progress-bar').css('width', progress + '%');
				$('#progress #percentValue').text(progress + '% Complete');
			}
		});
		$('#fileupload').bind('fileuploadsend', function (e, data) {
			//alert("X");
			$('#modal_progress').modal({
			  keyboard: false,
			  backdrop : 'static',
			  show : true
			});
			//Cookies.set('sap-upload',0);
		}).bind('fileuploaddone', function (e, data) {
			
			if(data.result[0].status == 'OK'){
				
				updateProgress(interval);
				$.post( site_url + 'xray/do_read_file',{file : data.result[0].server_path}, function(data){
					if(data.status == 'OK'){
						console.log("Read excel success");
						
						$('#modal_progress').modal('hide');
						
						$('#dgContact').datagrid('reload');
						//Cookies.remove('sap_upload');
					}
				},"json");
				
			}else{
				
			}
			//console.log(data.result[0].status);
			
		})
		
		
		function updateProgress(interval){
	//var percentUpload   = Cookies.get('sap-upload');
	//var interval = null;
	interval = setInterval( function() 
	{
		
		$.getJSON(base_url + 'progress.json',function(data){
			if(data.percentComplete == 1){
				clearInterval(interval);
				$('#modal_progress').modal('hide');
			}
			var progress = (data.percentComplete * 100).toFixed(1);
			
			$('#progress-excel .progress-bar').css('width', progress + '%');
			$('#progress-excel #percentValue-excel').text(progress + '% Complete');
			$('#readExcel').text('Read excel rows ' + (data.percentComplete*100).toFixed(2) + ' complete');
			//console.log(Cookies.get('pal_sap_upload'));
			
			//clearInterval(interval);
		});
	}, 1000);
}

	}


	//
	if($('#page-dg-feeder-mp').length > 0)
	{
		var interval = '';
		$(window).on('resize', function(){
			$('#dgContact').datagrid('resize');
		})

		$('#dgContact').datagrid({
			url: site_url + 'feeder/get_data_list',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			queryParams: {
			},
			columns:[[
				
				{field:'tgl_upload',title:'Tgl Upload',width:20},
				{field:'marketplace',title:'Nama MP', width:20, sortable:true, align:'left'},
				{field:'no_pesanan',title:'No Pesanan',width:45},
				{field:'awb',title:'No Barcode / AWB',width:45,
					formatter:function(v,r,i){
						if(v != ""){
							
							return v+" <a href='javascript:void(0);' onclick='openTracking(\""+v+"\");'><i class='fa fa-refresh'></i></a>";
						}
					}
				},
				{field:'pengirim',title:'Pengirim',width:45,
					formatter:function(v,r,i){
						return v+" - "+r.pengirim_telp+"<br/>"+r.pengirim_alamat;
					}
				},
				{field:'penerima',title:'Penerima',width:45,
					formatter:function(v,r,i){
						return v+" - "+r.penerima_telp+"<br/>"+r.penerima_alamat;
					}
				},
				//{field:'no_ticket',title:'No Tiket',width:45},
				{field:'status',title:'Informasi',width:45,
					formatter:function(v,r,i){
						if(r.isi_kiriman != null){
							return 'GAGAL XRAY '+r.isi_kiriman;
						}
					}
				},
				{field:'auto_id',title:'Aksi',width:15,
					formatter:function(v,r,i){
						if(r.no_ticket != null){
							return "<a href='"+site_url+"ticket/d/"+r.ticket_id+"'>Detail Tiket</a>";
						}else{
							return "<a href='javascript:void(0);' onclick='createTicket("+JSON.stringify(r)+");'> Buat Tiket </a>";
						}
						
					}
				},

				
			]]
		})

		$('#btn-search').on('click',function(){
			$('#dgContact').datagrid('reload',{search:$('#key-search').val()});
		});

		

		
		$('#key-search').on('keyup', function(){
			if($(this).val() ==''){
				$('#dgContact').datagrid('reload', {search:$('#key-search').val()});
			}
		});

		$('#fileupload').fileupload({
			url: site_url + 'feeder/do_upload',
			dataType: 'json',
			done: function (e, data) {
				$.each(data.result.files, function (index, file) {
					$('<p/>').text(file.name).appendTo('#files');
				});
			},
			progressall: function (e, data) {
				var progress = parseInt(data.loaded / data.total * 100, 10);
				$('#progress .progress-bar').css('width', progress + '%');
				$('#progress #percentValue').text(progress + '% Complete');
			}
		});
		$('#fileupload').bind('fileuploadsend', function (e, data) {
			//alert("X");
			$('#modal_progress').modal({
			  keyboard: false,
			  backdrop : 'static',
			  show : true
			});
			//Cookies.set('sap-upload',0);
		}).bind('fileuploaddone', function (e, data) {
			
			if(data.result[0].status == 'OK'){
				
				updateProgress(interval);
				$.post( site_url + 'feeder/do_read_file',{file : data.result[0].server_path}, function(data){
					if(data.status){
						$('#modal_progress').modal('hide');
						$('#dgContact').datagrid('reload');
					}
				},"json");
				
			}else{
				
			}
			//console.log(data.result[0].status);
			
		})
		
		
		function updateProgress(interval){
	//var percentUpload   = Cookies.get('sap-upload');
	//var interval = null;
	interval = setInterval( function() 
	{
		
		$.getJSON(base_url + 'progress.json',function(data){
			if(data.percentComplete == 1){
				clearInterval(interval);
				$('#modal_progress').modal('hide');
			}
			var progress = (data.percentComplete * 100).toFixed(1);
			
			$('#progress-excel .progress-bar').css('width', progress + '%');
			$('#progress-excel #percentValue-excel').text(progress + '% Complete');
			$('#readExcel').text('Read excel rows ' + (data.percentComplete*100).toFixed(2) + ' complete');
			//console.log(Cookies.get('pal_sap_upload'));
			
			//clearInterval(interval);
		});
	}, 1000);
}

	}


	if($('#page-dg-kprk').length > 0)
	{
		$(window).on('resize', function(){
			$('#dgContact').datagrid('resize');
		});

		$.post ( site_url + 'kprk/load_grid_data', function(res){
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#btn-search').on('click', function(){
			$('#dgContact').datagrid('reload',{search:$('#key').val(), start:$('#start').val(), end:$('#end').val()});
		});

		$('#dgContact').datagrid({
			url: site_url + 'kprk/get_data_list',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			//toolbar:"#toolbar",
			queryParams: {
				start:$('#start').val(),
				end:$('#end').val()
			},
			frozenColumns:[[
				
			]],
			columns:[[
				{field:'code',title:'No Dirian', width:10, sortable:true, align:'left'},
				{field:'name',title:'Nama Kantor Pos', width:40, sortable:true, align:'left'},
				{field:'regional',title:'Regional', width:30, sortable:true, align:'left'},
				{field:'total_ticket_keluar',title:'Tiket Keluar',width:10, sortable:true, align:'left'},
				{field:'total_ticket_masuk',title:'Tiket Masuk',width:10, sortable:true, align:'left'},
				
			]],
			
			onSelect: function(i, r){
				var count = $("#grid-body").children().length;
				if(count > 1){
					$('#grid-body > div.info-side-index').remove();
				}
				$('#grid-body > div:first').removeClass('col-md-12').addClass('col-md-8');
				
				var html_loader = '<div class="block-loader" id="loader-element" style="text-align: center; vertical-align: middle; height: 200px; margin-top: 25%; margin-bottom: auto;"><div class="lds-ripple"><div></div><div></div></div></div>';
				
				$('#grid-body').append(html_loader);
				$.post( site_url + 'kprk/load_detail_info',{ uid: r.code, start:$('#start').val(), end:$('#end').val()}, function(res){
					$('#grid-body #loader-element').remove();
					$('#grid-body').append('<div class="col-md-4 info-side-index bg-info" style="overflow:auto; height:'+dg_height+'px; margin-left:-11px;">'+res+'</div>');
				});
				$('#dgContact').datagrid('resize');
			}
		})
	}
	

	//ticket 
	if($('#page-ticket').length > 0)
	{
		$(window).on('resize', function(){
			$('#dgTicket').datagrid('resize');
		})
		
		$('ul.sections > li').removeClass('active');
		$('.sections > li > a[href="' + page + '"]').parent().addClass('active');
		
		$('ul.sections > li').on('click', function(){
			$('ul.sections > li').removeClass('active');
			$(this).addClass('active');
			page = $(this).children("a").attr('href');
			
			$('#dgTicket').datagrid('reload',{search:$('#search').val(), view:page});
		});

		var page = $(location).attr('hash');
		$('#dgTicket').datagrid({
			url: site_url + 'ticket/datalist',
			//title:'Data Ticket',
			height: dg_mail,
			nowrap: true,
			striped: true,
			remoteSort: true,
			singleSelect: false,
			fitColumns: true,
			pagination:true,
			checkbox:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				start: $('#start').val(),
				end: $('#end').val(),
				view:page
			},
			onCheck: function(node,checked){
				getTotalCheckbox();
			},
			onCheckAll: function(){
				getTotalCheckbox();
			},
			onUncheckAll:function(){
				getTotalCheckbox();
			},
			onUncheck:function(node, unchecked){
				getTotalCheckbox();
			},
			columns:[[
				{field:'ck', checkbox:true},
				{field:'no_ticket',title:'No Ticket', width:100, sortable:false, align:'center',
					formatter:function(v,r,i){
						return '<a href="'+site_url+'ticket/d/'+r.id+'" class="text-danger">'+v+'</a>';
					}
				},
				{field:'contact_name',title:'Contact',width:100, sortable:true,
					formatter:function(v,r,i){
						//<a href="'+site_url+'contacts/d/'+data[8]+'"
						return '<a href="'+site_url+'contacts/d/'+r.cid+'" class="text-danger">'+v+'</a>';
					}
				},
				{field:'subject',title:'Subject',width:100, sortable:true},
				{field:'category_name',title:'Category',width:100, sortable:true, align:'center'},
				/*
				{field:'priority',title:'Priority',width:100, sortable:true, align:'center',
					formatter:function(v,r,i){
							if(v == 1){
								return "Urgent";
							}else if(v == 2){
								return "High";
							}else if(v == 3){
								return "Medium";
							}else if(v == 4){
								return "Low";
							}else if(v == 5){
								return "-";
							}
						}
				},
				*/
				{field:'date',title:'Date',width:100, sortable:true, align:'center'},
				{field:'status',title:'Status',width:100, sortable:true, align:'center',
					formatter:function(v,r,i){
						var vclass;
						
						/*
						if(v == 1){
							vclass = 'primary';
						}else{
							vclass = 'info';
						}
						*/
						if(v == 1){
							vclass = 'warning';
						}else if(v == 12){
							vclass = 'info';
						}else if(v == 17){
							vclass = 'primary';
						}else if(v == 99){
							vclass = 'success';
						}
						return '<span class="label label-ticket label-'+vclass+'">'+r.status_name+'</span>';
					}
				}
			]]
		});
	}

	// Response 
	if( $('#page-response').length > 0)
	{
		var ticket = getUri(site_url, 3);
		$.post( site_url + 'app/get_ticket_history', {tid:ticket}, function(res){
			//console.log(res);
			//copyToClipboard('#toCopy');
			$('#toCopy').html(res);
		});

		$('#fileupload').fileupload({
			url: site_url + 'app/do_upload_response_tmp',
			dataType: 'json',
			formData:{ ticket_id : getUri(site_url, 3)},
			done: function (e, data) {
				$.each(data.result.files, function (index, file) {
					$('<p/>').text(file.name).appendTo('#files');
				});
			},
			progressall: function (e, data) {
				var progress = parseInt(data.loaded / data.total * 100, 10);
				$('#progress .progress-bar').css('width', progress + '%');
				$('#progress #percentValue').text(progress + '% Complete');
			}
		});
		$('#fileupload').bind('fileuploadsend', function (e, data) {
			/*
			$('#modal_progress').modal({
			  keyboard: false,
			  backdrop : 'static',
			  show : true
			});
			*/
			//Cookies.set('sap-upload',0);
		}).bind('fileuploaddone', function (e, data) {
			console.log(data);
			if(data.result.status){
				
				load_media_response();
				
			}else{
				swal("Sorry",data.msg, "error");
			}
			//console.log(data.result[0].status);
			
		})

		if (! $('html').hasClass('ie8')) {
			$('#response').summernote({
				toolbar: [
					// [groupName, [list of button]]
					['style', ['bold', 'italic', 'underline', 'clear']],
					//['font', ['strikethrough', 'superscript', 'subscript']],
					['fontsize', ['fontsize']],
					['color', ['color']],
					['para', ['ul', 'ol', 'paragraph']],
					//['height', ['height']]
				],
				height: 200,
				tabsize: 2,
				codemirror: {
					theme: 'monokai'
				},
				onImageUpload: function(files, editor, welEditable) {
					sendFile(files[0], editor, welEditable);
				},
				callbacks: {
					onChange: function (contents, $editable) {
						//console.log(contents);
						// Note that at this point, the value of the `textarea` is not the same as the one
						// you entered into the summernote editor, so you have to set it yourself to make
						// the validation consistent and in sync with the value.
						$('#response_val').val($('#response').summernote('isEmpty') ? "" : contents);
						
						if($('#response').summernote('isEmpty')){
							$('#btn-process').attr('disabled','disabled');
						}else{
							$('#btn-process').removeAttr('disabled');
						}
						//console.log("===>"+$('#response').val());
						// You should re-validate your element after change, because the plugin will have
						// no way to know that the value of your `textarea` has been changed if the change
						// was done programmatically.
					}
				}
			});
		}
		
		/*
		$.post ( site_url + 'app/ticketDetail', { cid : getUri(site_url, 3)}, function(res){
			if(res.assignee_val != ''){
				var html = '<option value="'+res.assignee_val+'">'+res.assignee_text+'</option>';
				$('#assignee').html(html);
			}
		},"json");
		*/
		
		$.post( site_url + 'ticket/form_response', { cid : getUri(site_url, 3)}, function(res){
			
			var assignee_html = "";
			if(res.data.assignee_val != ''){
				
				var opt 	= res.data.assignee_val.split(',');
				
				for(var i = 0; i<opt.length; i++){
					var s    = opt[i].split('|');
					var text_show		= opt[i].replace("|", " - ");
					//assignee_html		+= '<option selected="selected" value="'+s[0]+'">'+s[1]+'</option>';
					assignee_html		+= '<option selected="selected" value="'+opt[i]+'">'+text_show+'</option>';
				}		
				//var html = '<option value="'+res.data.assignee_val+'">'+res.data.assignee_text+'</option>';
				$('#assignee').html(assignee_html);
			}
			
			$('#status').select2({data:res.ticket_status, minimumResultsForSearch:Infinity}).val("").trigger('change');
			/*
			$('#status').on('select2:select', function (e) {
				var data = e.params.data;
				if(data.id <= res.data.status){
					$('#btn-process').attr('disabled','disabled');
				}else{
					$('#btn-process').removeAttr('disabled');
				}
			});
			*/
			$('#response-sroll-id').css({"height":dg_mail_sc+'px',"overflow":"auto"});
			$('#assignee').prop("disabled", true);
			//console.log(res.data.user_type);
			if(res.data.user_type == 'origin'){
				//$('#assignee').prop("disabled", false);
				
				$("#request option[value='0']").remove();
				$("#request option[value='1']").remove();
				
			}else{
				//$('#assignee').prop("disabled", true);
				$("#request option[value='2']").remove();
				$("#request option[value='3']").remove();
			}
			
			$('.select2min').select2({minimumResultsForSearch:Infinity});
			
			$('#request').on('select2:select', function (e) {
				var data = e.params.data;
				console.log(data.id);
				if(data.id == 3){
					//$('.statusSelect').removeClass('col-md-12').addClass('col-md-4');
					$('.selesaiOnly').removeClass('hidden');
					
				}else{
					//$('.statusSelect').addClass('col-md-12').removeClass('col-md-4');
					$('.selesaiOnly').addClass('hidden');
				}
			});
			//$('#no_resi').val(res.awb);
			//$('#asal_kiriman').val(res.sender);
			//$('#tujuan_kiriman').val(res.receiver);
		},"json");

		$('#assignee').select2({
			ajax: {
				url: site_url + 'app/kantor_posdd_new',
				dataType: 'json',
				method:"POST",
				delay: 250,
				processResults: function (data) {
					return {
						results : data
					}
				},
				cache: true
			},
			placeholder: 'Assignee',
			minimumInputLength: 1,
			tags: true,
			allowClear: false,
			multiple:true,
			escapeMarkup: function (markup) { return markup; },
		})
		
		
		
		$('#tags').select2({
			tags:true,
			multiple:true,
			//placeholder:"Tags",
			tokenSeparators: [',', ' ']
		})
		$('#priority').select2();
		
		var response_form = $("#ticket-form");
		response_form.validate({
			ignore:"",
			rules:{
				response_val:{required:true}
			},
			message:{
				response_val:{required:"Harus diisi"},
				response:{required:"Harus diisi"}
			},
			focusInvalid: true, 
			//errorPlacement: function () {},
			submitHandler: function(form) {
				
				//var $btn = $('#btn-submit').button('loading').attr('disabled','disabled');
				$('#btn-process').addClass('running').attr('disabled','disabled');
				$.post( site_url + 'ticket/saveResponses',$("#ticket-form").serialize(),function(data){
					
					if(data.status){
						
						swal({
							title: "Berhasil,",
							text: data.message,
							content:"success",
							//timer: 2000,
							buttons: {
								cancel: "Kembali ke Data Tiket",
								addnew: "Muat Ulang"
							},
							closeOnEsc: false,
							closeOnClickOutside: false
						}).then((value) => {
							switch (value) {
								case "addnew":
								  window.location.reload();
								  break;
								default:
									window.location.href = site_url + 'ticket';
							}
						});
						
						//$('#btn-process').removeClass('running').removeAttr('disabled');
					}else{
						//$.growl.error({ message: data.msg });
						swal("Sorry",data.message, "error");
					}
					$('#btn-process').removeClass('running').removeAttr('disabled');
				},'json').fail(function(jqXHR, textStatus, errorThrown) {
					$('#btn-process').removeClass('running').removeAttr('disabled');
					if(jqXHR.status == 500){
						swal("Sorry",res.message, "error");
					}else if(textStatus == 'parseerror'){
						//alert('Parse error');
						swal("Sorry","Error Parsing", "error");
						//howError();
					}
					
				});
				
			}
		});
		
	}
	
	// Report 
	if($('#page-rep-ticket').length > 0)
	{
		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/getTicketData',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'no_ticket',title:'No Ticket', width:100, sortable:false, align:'center',
					formatter:function(v,r,i){
						return '<a href="'+site_url+'ticket/d/'+r.id+'" class="text-danger">'+v+'</a>';
					}
				},
				{field:'contact_name',title:'Nama Pengadu',width:100, sortable:true,
					formatter:function(v,r,i){
						//<a href="'+site_url+'contacts/d/'+data[8]+'"
						return '<a href="'+site_url+'contacts/d/'+r.cid+'" class="text-danger">'+v+'</a>';
					}
				},
				{field:'complaint_origin',title:'Asal Pengaduan',width:100, sortable:true},
				{field:'kantor_tujuan_name',title:'Tujuan Pengaduan',width:100, sortable:true},
				{field:'sender',title:'Asal Kiriman',width:100, sortable:true},
				{field:'receiver',title:'Tujuan Kiriman',width:100, sortable:true},
				{field:'product',title:'Layanan',width:100, sortable:true},
				//{field:'category_name',title:'Category',width:100, sortable:true, align:'center'},
				{field:'date',title:'Date',width:100, sortable:true, align:'center'},
				{field:'duration_id',title:'Duration(hour)',width:100, sortable:true, align:'center'},
				{field:'awb',title:'No Barcode / AWB',width:100, sortable:true, align:'center',
					styler: function(v,row,index){
						if(row.status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
			]]
		})
	}
	

	if($('#page-rep-ticket-incoming').length > 0)
	{
		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_incoming_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:true,
			pagination:false,
			rownumbers:true,
			//pageSize:25,
			//pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'regional',title:'Regional', width:35, sortable:false, align:'left', rowspan:2,
					formatter:function(v,r,i){
						if(!r.isFooter)
						{
							return '<a href="'+site_url+'report/incoming_regional/'+r.id+'" class="text-danger">'+r.city+' ( '+v+' )</a>';
						}else{
							return v;
						}
						
					}
				},
				{field:'total_ticket',title:'Jumlah Pengaduan',width:10, sortable:true, rowspan:2, align:'center',
					formatter:function(v,r,i){
						return v;
						//<a href="'+site_url+'contacts/d/'+data[8]+'"
						//return '<a href="'+site_url+'contacts/d/'+r.cid+'" class="text-danger">'+v+'</a>';
					}
				},
				{title:'Selesai',width:10, sortable:true, align:'center', colspan:2},
				{title:'Terbuka',width:10, sortable:true, align:'center', colspan:2},
			],[
				{field:'total_selesai',title:'Jumlah',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
						
					}
				},
				{field:'percent_selesai',title:'%',width:10, sortable:true, align:'center'},
				{field:'total_terbuka',title:'Jumlah',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{field:'percent_terbuka',title:'%',width:10, sortable:true, align:'center'},
			]]
		})
	}

	if($('#page-rep-ticket-incoming-regional').length > 0)
	{
		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_incoming_regional_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:true,
			pagination:false,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				regid:getUri(site_url, 3),
				status:getUri(site_url, 4),
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'fullname',title:'KPRK', width:35, sortable:false, align:'left', rowspan:2,
					formatter:function(v,r,i){
						return '<a href="'+site_url+'report/incoming_kprk/'+r.code+'" class="text-danger">'+v+'</a>';
						//return v;
					}
				},
				{field:'total_ticket',title:'Jumlah Pengaduan',width:15, sortable:true, rowspan:2, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{title:'Selesai',width:10, sortable:true, align:'center', colspan:4},
				{title:'Terbuka',width:10, sortable:true, align:'center', colspan:4},
			],[
				{field:'total_selesai',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_selesai',title:'%',width:10, sortable:true, align:'center'},
				{field:'selesai_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
					}
				},
				{field:'selesai_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
				{field:'total_terbuka',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_terbuka',title:'%',width:10, sortable:true, align:'center'},
				{field:'terbuka_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
						
					}
				},
				{field:'terbuka_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
			]]
		})
	}

	if($('#page-rep-ticket-incoming-kprk').length > 0)
	{
		$('#status').select2({minimumResultsForSearch:Infinity});
		$('#status').on('select2:select', function (e) {
			var data = e.params.data;
			
			$('#dgTicket').datagrid('reload', {kprk:getUri(site_url, 3), start:$('#start').val(), end:$('#end').val(), filter:$('#status').val()})
		});
		$.post ( site_url + 'report/load_grid_data', function(res){
			//$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_incoming_kprk_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:false,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				kprk:getUri(site_url, 3),
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'no_ticket',title:'No Tiket', width:35, sortable:false, align:'left',
					formatter:function(v,r,i){
						return '<a href="'+site_url+'ticket/d/'+r.id+'" class="text-danger">'+v+'</a>';
						//return v;
					}
				},
				{field:'product_name',title:'Produk',width:15, sortable:true, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{field:'awb',title:'No Barcode / AWB',width:15, sortable:false, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{field:'status_text',title:'Status Akhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'office_name',title:'Update Terakhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'last_response',title:'Tgl Akhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'duration',title:'Durasi',width:15, sortable:false, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				}
			]]
		})
	}

	// outgoing
	if($('#page-rep-ticket-outgoing').length > 0)
	{
		$.post ( site_url + 'report/load_grid_data', function(res){
			//$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_outgoing_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			pagination:false,
			rownumbers:true,
			showFooter:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'regional',title:'Regional', width:35, sortable:false, align:'left', rowspan:2,
					formatter:function(v,r,i){
						if( !r.isFooter){
							return '<a href="'+site_url+'report/outgoing_regional/'+r.id+'" class="text-danger">'+r.city+' ( '+v+' )</a>';
						}else{
							return v;
						}
					}
				},
				{field:'total_ticket',title:'Jumlah Pengaduan',width:10, sortable:true, rowspan:2,
					formatter:function(v,r,i){
						return v;
					}
				},
				{title:'Selesai',width:10, sortable:true, align:'center', colspan:2},
				{title:'Terbuka',width:10, sortable:true, align:'center', colspan:2},
			],[
				{field:'total_selesai',title:'Jumlah',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
						
					}
				},
				{field:'percent_selesai',title:'%',width:10, sortable:true, align:'center'},
				{field:'total_terbuka',title:'Jumlah',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
					}
				},
				{field:'percent_terbuka',title:'%',width:10, sortable:true, align:'center'},
				
			]]
		})
	}

	if($('#page-rep-ticket-outgoing-regional').length > 0)
	{
		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_outgoing_regional_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:true,
			pagination:false,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				regid:getUri(site_url, 3),
				status:getUri(site_url, 4),
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'fullname',title:'KPRK', width:35, sortable:false, align:'left', rowspan:2,
					formatter:function(v,r,i){
						return '<a href="'+site_url+'report/outgoing_kprk/'+r.code+'" class="text-danger">'+v+'</a>';
						//return v;
					}
				},
				{field:'total_ticket',title:'Jumlah Pengaduan',width:15, sortable:true, rowspan:2, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{title:'Selesai',width:10, sortable:true, align:'center', colspan:4},
				{title:'Terbuka',width:10, sortable:true, align:'center', colspan:4},
			],[
				{field:'total_selesai',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_selesai',title:'%',width:10, sortable:true, align:'center'},
				{field:'selesai_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
					}
				},
				{field:'selesai_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
				{field:'total_terbuka',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_terbuka',title:'%',width:10, sortable:true, align:'center'},
				{field:'terbuka_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						
							return v;
						
						
					}
				},
				{field:'terbuka_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
			]]
		})
	}

	if($('#page-rep-ticket-outgoing-kprk').length > 0)
	{
		$('#status').select2({minimumResultsForSearch:Infinity});
		$('#status').on('select2:select', function (e) {
			var data = e.params.data;
			
			$('#dgTicket').datagrid('reload', {kprk:getUri(site_url, 3), start:$('#start').val(), end:$('#end').val(), filter:$('#status').val()})
		});
		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_outgoing_kprk_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:false,
			pagination:true,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				kprk:getUri(site_url, 3),
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'no_ticket',title:'No Tiket', width:35, sortable:false, align:'left',
					formatter:function(v,r,i){
						return '<a href="'+site_url+'ticket/d/'+r.id+'" class="text-danger">'+v+'</a>';
						//return v;
					}
				},
				{field:'product_name',title:'Produk',width:15, sortable:true, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{field:'awb',title:'No Barcode / AWB',width:15, sortable:false, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				},
				{field:'status_text',title:'Status Akhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'office_name',title:'Update Terakhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'last_response',title:'Tgl Akhir',width:15, sortable:false, align:'center',
					styler: function(v,row,index){
						
						if(row.last_status == 1){
							return 'background-color:#f4bb04;color:#FFF;';
						}else if(row.last_status == 12){
							return 'background-color:#138496;color:#FFF;';
						}else if(row.last_status == 17){
							return 'background-color:#1d89cf;color:#FFF;';
						}else if(row.last_status == 99){
							return 'background-color:#218838;color:#FFF;';
						}
					}
				},
				{field:'duration',title:'Durasi',width:15, sortable:false, align:'center',
					formatter:function(v,r,i){
						return v;
					}
				}
			]]
		})
	}

	if($('#page-rep-ticket-product').length > 0)
	{
		
		$('#btn-search').on('click', function(){
			$('#dgTicket').datagrid('reload',{search:$('#key').val(), start:$('#start').val(), end:$('#end').val()});
		});

		$.post ( site_url + 'report/load_grid_data', function(res){
			$('#status').select2({minimumResultsForSearch:Infinity, data:res.status});
			$('#start').val(res.date_start);
			$('#end').val(res.date_end);
		},"json");


		var ctx_all_product = document.getElementById('chart_product').getContext('2d');
		var	all_product = new Chart(ctx_all_product, {
			type: 'pie',
			/*
			type:'outlabeledPie',
			plugins: {
				display:false,
				legend: false,
				outlabels: {
					text: '%l %p',
					color: 'white',
					stretch: 1,
					font: {
						resizable: true,
						minSize: 12,
						maxSize: 18
					}
				}
			},
			*/
			options: {
				onClick: function(evt, activeElements) {
					var elementIndex = activeElements[0]._index;
					
				},
				title : {
					display: true,
					position : 'top',
					text : 'Pengaduan by Produk'
				},
				legend: {
					display:false,
					position : 'bottom',
					labels: { fontColor: 'black', boxWidth:20},			
				},
				tooltips: {
					callbacks: {
						title: function(tooltipItem, data) {
							var currentLabel = data.labels[tooltipItem[0].index];
							//return currentLabel;
						},
						label: function(tooltipItem, data) {
							
							
							var currentLabel = data.labels[tooltipItem.index]
							//return percentage + " % ";
							return ""+currentLabel+" :";
							//var multistringText = ["Diselesaikan "+currentLabel+" :"];
							//multistringText.push("Jumlah Aduan "+currentValue +"( "+percentage+"% )");
							//return multistringText;
						},
						footer: function(tooltipItem, data) {
							var dataset = data.datasets[tooltipItem[0].datasetIndex];
							var total = dataset.data.reduce(function(previousValue, currentValue, currentIndex, array) {
								return previousValue + currentValue;
							});
							var currentValue = dataset.data[tooltipItem[0].index];
							var percentage = Math.floor(((currentValue/total) * 100)+0.5);         

							var multistringText = ["Jumlah : "+currentValue+" "];
							multistringText.push("Persentase : "+percentage+" %");
							return multistringText;
						}
					}
				}
			}
		});

		$.post( site_url + 'report/get_product_ticket', {start:$('#start').val(), end:$('end').val()}, function(res){
			all_product.data = res.chart_product;
			all_product.update();
		},"json");

		$('#dgTicket').datagrid({
			url: site_url + 'report/get_product_ticket',
			//title:'Data Ticket',
			height: dg_height,
			nowrap: false,
			striped: true,
			remoteSort: true,
			singleSelect: true,
			fitColumns: true,
			showFooter:true,
			pagination:false,
			rownumbers:true,
			pageSize:25,
			pageList:[25,50,75,100],
			toolbar:"#toolbar",
			queryParams: {
				regid:getUri(site_url, 3),
				status:getUri(site_url, 4),
				start: $('#start').val(),
				end: $('#end').val()
			},
			columns:[[
				{field:'name',title:'Nama Produk', width:35, sortable:false, align:'left',
					formatter:function(v,r,i){
						//return '<a href="'+site_url+'report/outgoing_kprk/'+r.code+'" class="text-danger">'+v+'</a>';
						return v;
					}
				},
				{field:'total_ticket',title:'Jumlah Pengaduan',width:15, sortable:true, align:'center',
					formatter:function(v,r,i){
						return v;
						//<a href="'+site_url+'contacts/d/'+data[8]+'"
						//return '<a href="'+site_url+'contacts/d/'+r.cid+'" class="text-danger">'+v+'</a>';
					}
				},
				//{title:'Selesai',width:10, sortable:true, align:'center', colspan:4},
				//{title:'Terbuka',width:10, sortable:true, align:'center', colspan:4},
				/*
				{field:'category_name',title:'Category',width:10, sortable:true, align:'center'},
				{field:'date',title:'Date',width:10, sortable:true, align:'center'},
				{field:'duration_id',title:'Duration(hour)',width:10, sortable:true, align:'center'},
				{field:'status',title:'Status',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						var vclass;
						if(v == 1){
							vclass = 'warning';
						}else if(v == 12){
							vclass = 'info';
						}else if(v == 17){
							vclass = 'primary';
						}else if(v == 99){
							vclass = 'success';
						}
						return '<span class="label label-ticket label-'+vclass+'">'+r.status_name+'</span>';
					}
				}
				*/
			]
			/*,[
				{field:'total_selesai',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_selesai',title:'%',width:10, sortable:true, align:'center'},
				{field:'selesai_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						if(v > 0){
							return '<a href="'+site_url+'report/incoming_detail/'+r.id+'/A" class="text-danger">'+v+'</a>';
						}else{
							return v;
						}
					}
				},
				{field:'selesai_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
				{field:'total_terbuka',title:'Jumlah',width:10, sortable:true, align:'center'},
				{field:'percent_terbuka',title:'%',width:10, sortable:true, align:'center'},
				{field:'terbuka_a',title:'<= 24 Jam',width:10, sortable:true, align:'center',
					formatter:function(v,r,i){
						if(v > 0){
							return '<a href="'+site_url+'report/incoming_regional/'+r.id+'/selesai" class="text-danger">'+v+'</a>';
						}else{
							return v;
						}
						
					}
				},
				{field:'terbuka_b',title:'> 24 Jam',width:10, sortable:true, align:'center'},
				
			]*/],
			onSelect: function(i, r){
				var count = $("#grid-body").children().length;
				if(count > 1){
					$('#grid-body > div.info-side-index').remove();
				}
				$('#grid-body > div:first').removeClass('col-md-12').addClass('col-md-8');
				
				var html_loader = '<div class="block-loader" id="loader-element" style="text-align: center; vertical-align: middle; height: 200px; margin-top: 25%; margin-bottom: auto;"><div class="lds-ripple"><div></div><div></div></div></div>';
				
				$('#grid-body').append(html_loader);
				$.post( site_url + 'report/load_detail_info_product',{ uid: r.code, start:$('#start').val(), end:$('#end').val()}, function(res){
					$('#grid-body #loader-element').remove();
					$('#grid-body').append('<div class="col-md-4 info-side-index bg-info" style="overflow:auto; height:'+dg_height+'px; margin-left:-11px;">'+res+'</div>');
				});
				$('#dgTicket').datagrid('resize');
			}
		})
	}
	/*
	socket.on('ticketNew', function(result){
		$.growl({ title: "New Ticket", message: "Ticket No : #"+result, size: 'large' });
	});
	socket.on('ticketResponse', function(result){
		$.growl({ title: "Ticket Response", message: "Ticket No : #"+result, size: 'large' });
	});
	*/

	// REKAP LAYANAN 
	if($('#page-rekap-layanan').length > 0)
	{
		$.post( site_url + 'report/load_rekap_layanan', function(res){
			/*
			// Rekap Info
			var html_info_head = '';
			html_info_head += '<tr>';
			$.each(res.info_head, function( key, value ) {
				html_info_head += '<th data-options="field:'+value.name+'">'+value.name+'</th>';
			});
			html_info_head += '</tr>';
			$('#rekap_info > thead').append(html_info_head);

			var html_info_body = '';
			html_info_body += '<tr>';
			$.each(res.info, function( key, value ) {
				$.each(value, function( k, v ) {
					html_info_body += '<td>'+v+'</td>';
				});
			});
			html_info_body += '</tr>';
			$('#rekap_info > tbody').append(html_info_body);

			// Rekap Aduan
			var html_aduan_body = '';
			html_aduan_body += '<tr>';
			$.each(res.aduan, function(k,v){
				html_aduan_body += '<td>'+v+'</td>';
			});
			html_aduan_body += '<tr>';
			$('#rekap_aduan > tbody').append(html_aduan_body);

			// rekap masalah 
			var html_m_head = '';
			html_m_head += '<tr><td rowspan="2">Produk</td><td colspan="'+(res.masalah_head.length - 1)+'">Masalah</td></tr>';
			html_m_head += '<tr>';
				$.each(res.masalah_head, function( key, value ) {
					if( value.name !== 'name'){
						html_m_head += '<td>'+value.name+'</td>';
					}
				});
			html_m_head += '</tr>';
			$('#rekap_masalah_produk > thead').append(html_m_head);
			var html_m_body = '';
			
			$.each(res.masalah, function( key, value ) {
				html_m_body += '<tr>';
				$.each(value, function( k, v ) {
					html_m_body += '<td>'+v+'</td>';
				});
				html_m_body += '</tr>';
			});
			
			$('#rekap_masalah_produk > tbody').append(html_m_body);
			//$('td#rekap_masalah_produk').attr('colspan',res.masalah_head.length - 1);
			*/
			$('#dgTicket').datagrid({
				height: 60,
				nowrap: false,
				fitColumns: true,
				pagination:false,
				columns:[res.dinfo_head],
				data:res.dinfo_body
			});

			$('#dgTicketAduan').datagrid({
				height: 80,
				nowrap: false,
				fitColumns: true,
				pagination:false,
				columns:[[
					{field:'total',title:'Jumlah CCH diterima',width:10, sortable:true, align:'center', rowspan:2},
					{title:'Selesai', align:'center', colspan:2},
					{title:'Terbuka', align:'center', colspan:2},
					{title:'Selesai 24 Jam', align:'center', colspan:2},
					{title:'Selesai > 24 Jam', align:'center', colspan:2},
				],[
					{field:'selesai',title:'Jumlah',width:10, sortable:true, align:'center'},
					{field:'selesai_percent',title:'%',width:10, sortable:true, align:'center'},
					{field:'terbuka',title:'Jumlah',width:10, sortable:true, align:'center'},
					{field:'terbuka_percent',title:'%',width:10, sortable:true, align:'center'},
					{field:'grade_a',title:'Jumlah',width:10, sortable:true, align:'center'},
					{field:'grade_a_percent',title:'%',width:10, sortable:true, align:'center'},
					{field:'grade_b',title:'Jumlah',width:10, sortable:true, align:'center'},
					{field:'grade_b_percent',title:'%',width:10, sortable:true, align:'center'},
				]],
				data:[res.aduan]
			});
			
			$('#dgTicketMasalahProduk').datagrid({
				height: 300,
				nowrap: false,
				fitColumns: true,
				pagination:false,
				columns:[res.dmasalah_head],
				data:res.masalah
			});
		},"json");
		
	}
	
})
// END INIT
function reloadPage(){
	location.reload();
}

function selectExternalData(name, code, element){
	$('#'+element).val(name);
	$('#'+element+'_hidden').val(code);
	$('.modal').modal('hide');
}

function getDate(show){
	//alert(show);
	
	var date = new Date();
	if(show == 'first'){
		var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
		var result	= (firstDay.getDate() + '/' + (firstDay.getMonth() + 1) + '/' +  firstDay.getFullYear());
	}else if(show == 'last'){
		var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
		var result	= (lastDay.getDate() + '/' + (lastDay.getMonth() + 1) + '/' +  lastDay.getFullYear());
	}else{
		var result	= (date.getDate() + '/' + (date.getMonth() + 1) + '/' +  date.getFullYear());
	}
	
	return result;
}


